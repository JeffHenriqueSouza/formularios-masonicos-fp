<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FP 12 - Fornecimentos | Federa√ß√£o Portuguesa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #16a085 0%, #2ecc71 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 950px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #16a085 0%, #2ecc71 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="masonic" patternUnits="userSpaceOnUse" width="20" height="20"><path d="M10,2 L18,10 L10,18 L2,10 Z" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23masonic)"/></svg>');
            opacity: 0.1;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .form-content {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-row.single {
            grid-template-columns: 1fr;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #16a085;
            font-size: 14px;
        }

        input[type="text"],
        input[type="email"],
        input[type="date"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #16a085;
            background: white;
            box-shadow: 0 0 0 3px rgba(22, 160, 133, 0.1);
        }

        .logo-upload {
            border: 2px dashed #16a085;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .logo-upload:hover {
            border-color: #2ecc71;
            background: #ecf0f1;
        }

        .logo-upload.dragover {
            border-color: #16a085;
            background: #e8f4fd;
        }

        .fornecimentos-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            border-left: 5px solid #16a085;
        }

        .fornecimentos-section h2 {
            color: #16a085;
            margin-bottom: 25px;
            font-size: 22px;
            text-align: center;
        }

        .item-fornecimento {
            display: grid;
            grid-template-columns: 80px 1fr 120px 100px;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .item-fornecimento:hover {
            box-shadow: 0 5px 15px rgba(22, 160, 133, 0.1);
            border-color: #16a085;
        }

        .item-quantidade {
            text-align: center;
        }

        .item-quantidade input {
            width: 100%;
            text-align: center;
            margin: 0;
            padding: 8px;
            border: 2px solid #16a085;
            border-radius: 5px;
        }

        .item-descricao {
            font-weight: 500;
            color: #2c3e50;
        }

        .item-preco {
            font-weight: 600;
            color: #16a085;
            text-align: center;
        }

        .item-total {
            font-weight: 700;
            color: #27ae60;
            text-align: center;
            font-size: 16px;
        }

        .total-geral {
            background: #27ae60;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 30px 0;
            text-align: center;
        }

        .total-geral h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .total-geral .valor {
            font-size: 32px;
            font-weight: 700;
        }

        .signature-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
        }

        .signature-pad-container {
            border: 2px solid #16a085;
            border-radius: 8px;
            background: white;
            margin: 10px 0;
        }

        .signature-pad {
            width: 100%;
            height: 150px;
            border-radius: 6px;
        }

        .signature-controls {
            text-align: center;
            margin-top: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #16a085 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(22, 160, 133, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }

        .btn-export {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            font-size: 16px;
            padding: 15px 30px;
        }

        .export-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            text-align: center;
        }

        .logo-preview {
            max-width: 200px;
            max-height: 100px;
            margin: 10px auto;
            display: block;
            border-radius: 5px;
        }

        .custom-items {
            margin-top: 30px;
            padding: 20px;
            background: #e8f6f3;
            border-radius: 10px;
        }

        .custom-items h3 {
            color: #16a085;
            margin-bottom: 15px;
        }

        .custom-item {
            display: grid;
            grid-template-columns: 80px 1fr 120px 100px;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }

        .info-box {
            background: #fff5cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        /* Modal de Pr√©-visualiza√ß√£o */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            height: 90%;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .preview-content {
            font-family: 'Times New Roman', serif;
            line-height: 1.4;
            color: #000;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .form-content {
                padding: 20px;
            }

            .item-fornecimento,
            .custom-item {
                grid-template-columns: 1fr;
                gap: 10px;
                text-align: center;
            }
        }

        .required {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõí FP 12 - FORNECIMENTOS</h1>
            <p>Ordem Ma√ß√≥nica Mista Internacional ¬´Le Droit Humain¬ª - Federa√ß√£o Portuguesa</p>
        </div>

        <div class="form-content">
            <form id="fp12Form">
                <!-- Upload do Log√≥tipo -->
                <div class="form-group">
                    <label for="logoUpload">Log√≥tipo da Loja (opcional)</label>
                    <div class="logo-upload" id="logoUpload">
                        <p>üìÅ Clique ou arraste uma imagem aqui</p>
                        <small>Formatos aceites: JPG, PNG, GIF (m√°x. 2MB)</small>
                        <input type="file" id="logoFile" accept="image/*" style="display: none;">
                        <img id="logoPreview" class="logo-preview" style="display: none;">
                    </div>
                </div>

                <!-- Dados da Loja -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="loja">Loja <span class="required">*</span></label>
                        <select id="loja" required>
                            <option value="">Selecione a Loja</option>
                            <option value="Loja Ac√°cia N¬∫ 1">Loja Ac√°cia N¬∫ 1</option>
                            <option value="Loja Liberdade N¬∫ 2">Loja Liberdade N¬∫ 2</option>
                            <option value="Loja Fraternidade N¬∫ 3">Loja Fraternidade N¬∫ 3</option>
                            <option value="Loja Igualdade N¬∫ 4">Loja Igualdade N¬∫ 4</option>
                            <option value="Loja Harmonia N¬∫ 5">Loja Harmonia N¬∫ 5</option>
                            <option value="Outra">Outra</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="numeroLoja">N√∫mero da Loja</label>
                        <input type="text" id="numeroLoja" placeholder="N√∫mero da loja">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="oriente">Oriente <span class="required">*</span></label>
                        <input type="text" id="oriente" required placeholder="Ex: Lisboa">
                    </div>
                    <div class="form-group">
                        <label for="dataPedido">Data do Pedido <span class="required">*</span></label>
                        <input type="date" id="dataPedido" required>
                    </div>
                </div>

                <!-- Se√ß√£o de Fornecimentos -->
                <div class="fornecimentos-section">
                    <h2>üì¶ Solicitar Fornecimentos</h2>
                    <p style="text-align: center; margin-bottom: 25px; color: #666;">
                        Indique a quantidade desejada para cada item. O valor ser√° calculado automaticamente.
                    </p>

                    <div class="item-fornecimento">
                        <div class="item-quantidade">
                            <input type="number" id="const_qty" min="0" value="0" onchange="calculateTotals()">
                        </div>
                        <div class="item-descricao">Constitui√ß√£o</div>
                        <div class="item-preco">‚Ç¨2,00</div>
                        <div class="item-total" id="const_total">‚Ç¨0,00</div>
                    </div>

                    <div class="item-fornecimento">
                        <div class="item-quantidade">
                            <input type="number" id="reg_qty" min="0" value="0" onchange="calculateTotals()">
                        </div>
                        <div class="item-descricao">Regulamentos</div>
                        <div class="item-preco">‚Ç¨1,50</div>
                        <div class="item-total" id="reg_total">‚Ç¨0,00</div>
                    </div>

                    <div class="item-fornecimento">
                        <div class="item-quantidade">
                            <input type="number" id="mem_apr_qty" min="0" value="0" onchange="calculateTotals()">
                        </div>
                        <div class="item-descricao">Memento de Aprendiz</div>
                        <div class="item-preco">‚Ç¨1,00</div>
                        <div class="item-total" id="mem_apr_total">‚Ç¨0,00</div>
                    </div>

                    <div class="item-fornecimento">
                        <div class="item-quantidade">
                            <input type="number" id="mem_comp_qty" min="0" value="0" onchange="calculateTotals()">
                        </div>
                        <div class="item-descricao">Memento de Companheiro</div>
                        <div class="item-preco">‚Ç¨1,00</div>
                        <div class="item-total" id="mem_comp_total">‚Ç¨0,00</div>
                    </div>

                    <div class="item-fornecimento">
                        <div class="item-quantidade">
                            <input type="number" id="mem_mest_qty" min="0" value="0" onchange="calculateTotals()">
                        </div>
                        <div class="item-descricao">Memento de Mestre</div>
                        <div class="item-preco">‚Ç¨1,00</div>
                        <div class="item-total" id="mem_mest_total">‚Ç¨0,00</div>
                    </div>

                    <div class="item-fornecimento">
                        <div class="item-quantidade">
                            <input type="number" id="livro_qty" min="0" value="0" onchange="calculateTotals()">
                        </div>
                        <div class="item-descricao">Livro "Grandes Mestres, tendes a palavra"</div>
                        <div class="item-preco">‚Ç¨15,00</div>
                        <div class="item-total" id="livro_total">‚Ç¨0,00</div>
                    </div>

                    <div class="item-fornecimento">
                        <div class="item-quantidade">
                            <input type="number" id="med_pass_qty" min="0" value="0" onchange="calculateTotals()">
                        </div>
                        <div class="item-descricao">Medalha da Passagem √† Federa√ß√£o</div>
                        <div class="item-preco">‚Ç¨10,00</div>
                        <div class="item-total" id="med_pass_total">‚Ç¨0,00</div>
                    </div>

                    <div class="item-fornecimento">
                        <div class="item-quantidade">
                            <input type="number" id="med_adelaide_qty" min="0" value="0" onchange="calculateTotals()">
                        </div>
                        <div class="item-descricao">Medalha de Adelaide Cabete</div>
                        <div class="item-preco">‚Ç¨16,00</div>
                        <div class="item-total" id="med_adelaide_total">‚Ç¨0,00</div>
                    </div>

                    <div class="item-fornecimento">
                        <div class="item-quantidade">
                            <input type="number" id="prato_qty" min="0" value="0" onchange="calculateTotals()">
                        </div>
                        <div class="item-descricao">Prato decorativo ma√ß√≥nico Jurisdi√ß√£o Port.</div>
                        <div class="item-preco">‚Ç¨5,00</div>
                        <div class="item-total" id="prato_total">‚Ç¨0,00</div>
                    </div>

                    <div class="item-fornecimento">
                        <div class="item-quantidade">
                            <input type="number" id="pin_qty" min="0" value="0" onchange="calculateTotals()">
                        </div>
                        <div class="item-descricao">Pin da Federa√ß√£o Portuguesa</div>
                        <div class="item-preco">‚Ç¨1,00</div>
                        <div class="item-total" id="pin_total">‚Ç¨0,00</div>
                    </div>

                    <div class="item-fornecimento">
                        <div class="item-quantidade">
                            <input type="number" id="form1_qty" min="0" value="0" onchange="calculateTotals()">
                        </div>
                        <div class="item-descricao">Formul√°rio n¬∫ 1 (A3 com 4 p√°g.)</div>
                        <div class="item-preco">‚Ç¨0,50</div>
                        <div class="item-total" id="form1_total">‚Ç¨0,00</div>
                    </div>

                    <!-- Itens Personalizados -->
                    <div class="custom-items">
                        <h3>‚ûï Outros Itens (Personalizados)</h3>
                        <div id="customItems">
                            <div class="custom-item">
                                <div>
                                    <input type="number" id="custom1_qty" min="0" value="0" onchange="calculateTotals()" placeholder="Qtd">
                                </div>
                                <div>
                                    <input type="text" id="custom1_desc" placeholder="Descri√ß√£o do item personalizado">
                                </div>
                                <div>
                                    <input type="number" id="custom1_price" min="0" step="0.01" value="0" onchange="calculateTotals()" placeholder="Pre√ßo">
                                </div>
                                <div class="item-total" id="custom1_total">‚Ç¨0,00</div>
                            </div>
                            <div class="custom-item">
                                <div>
                                    <input type="number" id="custom2_qty" min="0" value="0" onchange="calculateTotals()" placeholder="Qtd">
                                </div>
                                <div>
                                    <input type="text" id="custom2_desc" placeholder="Descri√ß√£o do item personalizado">
                                </div>
                                <div>
                                    <input type="number" id="custom2_price" min="0" step="0.01" value="0" onchange="calculateTotals()" placeholder="Pre√ßo">
                                </div>
                                <div class="item-total" id="custom2_total">‚Ç¨0,00</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Geral -->
                <div class="total-geral">
                    <h3>üí∞ Total Geral</h3>
                    <div class="valor" id="totalGeral">‚Ç¨0,00</div>
                </div>

                <!-- Informa√ß√µes de Pagamento -->
                <div class="info-box">
                    <h4>üí° Informa√ß√µes de Pagamento</h4>
                    <p>Os valores devidos, ap√≥s fornecimento, ser√£o debitados na factura anual, caso n√£o sejam pagos contra a entrega dos elementos pedidos.</p>
                </div>

                <!-- Informa√ß√µes de Contato -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="nomeVM">Nome do V‚à¥M‚à¥ <span class="required">*</span></label>
                        <input type="text" id="nomeVM" required placeholder="Nome completo do Vener√°vel Mestre">
                    </div>
                    <div class="form-group">
                        <label for="nomeSecretario">Nome do Sec‚à¥ Orad‚à¥ <span class="required">*</span></label>
                        <input type="text" id="nomeSecretario" required placeholder="Nome completo do Secret√°rio Orador">
                    </div>
                </div>

                <!-- Assinatura Digital -->
                <div class="signature-section">
                    <h3>Assinaturas Digitais</h3>
                    <div class="form-row">
                        <div>
                            <p><strong>V‚à¥M‚à¥:</strong></p>
                            <div class="signature-pad-container">
                                <canvas class="signature-pad" id="signaturePadVM"></canvas>
                            </div>
                            <div class="signature-controls">
                                <button type="button" class="btn btn-secondary" onclick="clearSignature('signaturePadVM')">üóëÔ∏è Limpar</button>
                            </div>
                        </div>
                        <div>
                            <p><strong>Sec‚à¥ Orad‚à¥:</strong></p>
                            <div class="signature-pad-container">
                                <canvas class="signature-pad" id="signaturePadSec"></canvas>
                            </div>
                            <div class="signature-controls">
                                <button type="button" class="btn btn-secondary" onclick="clearSignature('signaturePadSec')">üóëÔ∏è Limpar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Exporta√ß√£o -->
                <div class="export-section">
                    <h3>üíæ Exportar Pedido de Fornecimentos</h3>
                    <p>Escolha o formato de exporta√ß√£o desejado:</p>
                    <button type="button" class="btn btn-info" onclick="showPreview()">üëÅÔ∏è Pr√©-visualizar</button>
                    <button type="button" class="btn btn-export" onclick="exportToWord()">üìÑ Exportar para Word</button>
                    <button type="button" class="btn btn-export" onclick="exportToPDF()">üìã Exportar para PDF</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Pr√©-visualiza√ß√£o -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìã Pr√©-visualiza√ß√£o do Documento</h2>
                <span class="close">&times;</span>
            </div>
            <div id="previewContent" class="preview-content">
                <!-- Conte√∫do ser√° inserido aqui via JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Inicializar Signature Pads
        const canvasVM = document.getElementById('signaturePadVM');
        const canvasSec = document.getElementById('signaturePadSec');
        const signaturePadVM = new SignaturePad(canvasVM);
        const signaturePadSec = new SignaturePad(canvasSec);

        // Redimensionar canvas
        function resizeCanvas() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            [canvasVM, canvasSec].forEach(canvas => {
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                canvas.getContext("2d").scale(ratio, ratio);
            });
            signaturePadVM.clear();
            signaturePadSec.clear();
        }

        window.addEventListener("resize", resizeCanvas);
        setTimeout(resizeCanvas, 100);

        // Limpar assinatura
        function clearSignature(canvasId) {
            if (canvasId === 'signaturePadVM') {
                signaturePadVM.clear();
            } else if (canvasId === 'signaturePadSec') {
                signaturePadSec.clear();
            }
        }

        // Upload de log√≥tipo
        const logoUpload = document.getElementById('logoUpload');
        const logoFile = document.getElementById('logoFile');
        const logoPreview = document.getElementById('logoPreview');

        logoUpload.addEventListener('click', () => logoFile.click());
        
        logoUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            logoUpload.classList.add('dragover');
        });

        logoUpload.addEventListener('dragleave', () => {
            logoUpload.classList.remove('dragover');
        });

        logoUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            logoUpload.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleLogoFile(files[0]);
            }
        });

        logoFile.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleLogoFile(e.target.files[0]);
            }
        });

        function handleLogoFile(file) {
            if (file.type.startsWith('image/') && file.size <= 2 * 1024 * 1024) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    logoPreview.src = e.target.result;
                    logoPreview.style.display = 'block';
                    logoUpload.innerHTML = `
                        <img src="${e.target.result}" class="logo-preview">
                        <p>‚úÖ Log√≥tipo carregado</p>
                        <small>Clique para alterar</small>
                    `;
                };
                reader.readAsDataURL(file);
            } else {
                alert('Por favor, selecione uma imagem v√°lida (m√°x. 2MB).');
            }
        }

        // Calcular totais
        function calculateTotals() {
            const items = [
                {id: 'const', price: 2.00},
                {id: 'reg', price: 1.50},
                {id: 'mem_apr', price: 1.00},
                {id: 'mem_comp', price: 1.00},
                {id: 'mem_mest', price: 1.00},
                {id: 'livro', price: 15.00},
                {id: 'med_pass', price: 10.00},
                {id: 'med_adelaide', price: 16.00},
                {id: 'prato', price: 5.00},
                {id: 'pin', price: 1.00},
                {id: 'form1', price: 0.50}
            ];

            let totalGeral = 0;

            // Calcular itens fixos
            items.forEach(item => {
                const qty = parseInt(document.getElementById(item.id + '_qty').value) || 0;
                const total = qty * item.price;
                document.getElementById(item.id + '_total').textContent = `‚Ç¨${total.toFixed(2)}`;
                totalGeral += total;
            });

            // Calcular itens personalizados
            for (let i = 1; i <= 2; i++) {
                const qty = parseInt(document.getElementById(`custom${i}_qty`).value) || 0;
                const price = parseFloat(document.getElementById(`custom${i}_price`).value) || 0;
                const total = qty * price;
                document.getElementById(`custom${i}_total`).textContent = `‚Ç¨${total.toFixed(2)}`;
                totalGeral += total;
            }

            document.getElementById('totalGeral').textContent = `‚Ç¨${totalGeral.toFixed(2)}`;
        }

        // Valida√ß√£o de formul√°rio
        function validateForm() {
            const required = document.querySelectorAll('[required]');
            let valid = true;

            required.forEach(field => {
                if (!field.value.trim()) {
                    field.style.borderColor = '#e74c3c';
                    valid = false;
                } else {
                    field.style.borderColor = '#ecf0f1';
                }
            });

            if (signaturePadVM.isEmpty() || signaturePadSec.isEmpty()) {
                alert('Por favor, assine o formul√°rio (ambas as assinaturas s√£o obrigat√≥rias).');
                valid = false;
            }

            const totalValue = parseFloat(document.getElementById('totalGeral').textContent.replace('‚Ç¨', ''));
            if (totalValue <= 0) {
                alert('Por favor, selecione pelo menos um item para solicitar.');
                valid = false;
            }

            return valid;
        }

        // Fun√ß√µes de Pr√©-visualiza√ß√£o
        function showPreview() {
            if (!validateForm()) {
                alert('Por favor, preencha todos os campos obrigat√≥rios antes de visualizar.');
                return;
            }

            const modal = document.getElementById('previewModal');
            const previewContent = document.getElementById('previewContent');
            
            const content = generatePreviewContent();
            previewContent.innerHTML = content;
            
            modal.style.display = 'block';
        }

        function generatePreviewContent() {
            const loja = document.getElementById('loja').value;
            const numeroLoja = document.getElementById('numeroLoja').value || 'N/A';
            const oriente = document.getElementById('oriente').value;
            const dataPedido = document.getElementById('dataPedido').value;
            const nomeVM = document.getElementById('nomeVM').value;
            const nomeSecretario = document.getElementById('nomeSecretario').value;

            let html = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="margin: 0; font-size: 18px;">ORDEM MA√á√ìNICA MISTA INTERNACIONAL</h2>
                    <h3 style="margin: 5px 0; font-size: 16px;">¬´LE DROIT HUMAIN¬ª - FEDERA√á√ÉO PORTUGUESA</h3>
                    <h2 style="margin: 20px 0; font-size: 16px; text-decoration: underline;">FORNECIMENTOS</h2>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p><strong>R‚à¥L‚à¥:</strong> ${loja} N¬∫ ${numeroLoja}</p>
                    <p><strong>Or‚à¥ de:</strong> ${oriente}, ${dataPedido}</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <p><strong>Solicitamos o fornecimento de:</strong></p>
                </div>
            `;

            // Adicionar itens solicitados
            const items = [
                {id: 'const', name: 'Constitui√ß√£o', price: 2.00},
                {id: 'reg', name: 'Regulamentos', price: 1.50},
                {id: 'mem_apr', name: 'Memento de Aprendiz', price: 1.00},
                {id: 'mem_comp', name: 'Memento de Companheiro', price: 1.00},
                {id: 'mem_mest', name: 'Memento de Mestre', price: 1.00},
                {id: 'livro', name: 'Livro "Grandes Mestres, tendes a palavra"', price: 15.00},
                {id: 'med_pass', name: 'Medalha da Passagem √† Federa√ß√£o', price: 10.00},
                {id: 'med_adelaide', name: 'Medalha de Adelaide Cabete', price: 16.00},
                {id: 'prato', name: 'Prato decorativo ma√ß√≥nico Jurisdi√ß√£o Port.', price: 5.00},
                {id: 'pin', name: 'Pin da Federa√ß√£o Portuguesa', price: 1.00},
                {id: 'form1', name: 'Formul√°rio n¬∫ 1 (A3 com 4 p√°g.)', price: 0.50}
            ];

            items.forEach(item => {
                const qty = parseInt(document.getElementById(item.id + '_qty').value) || 0;
                if (qty > 0) {
                    const total = qty * item.price;
                    html += `
                        <p style="margin: 5px 0;">
                            <strong>${qty}</strong> exemplares ${item.name} 
                            (custo unit√°rio: ‚Ç¨${item.price.toFixed(2)}) 
                            ----------------------- <strong>‚Ç¨${total.toFixed(2)}</strong>
                        </p>
                    `;
                }
            });

            // Adicionar itens personalizados
            for (let i = 1; i <= 2; i++) {
                const qty = parseInt(document.getElementById(`custom${i}_qty`).value) || 0;
                const desc = document.getElementById(`custom${i}_desc`).value;
                const price = parseFloat(document.getElementById(`custom${i}_price`).value) || 0;
                
                if (qty > 0 && desc) {
                    const total = qty * price;
                    html += `
                        <p style="margin: 5px 0;">
                            <strong>${qty}</strong> exemplares ${desc} 
                            (custo unit√°rio: ‚Ç¨${price.toFixed(2)}) 
                            ----------------------- <strong>‚Ç¨${total.toFixed(2)}</strong>
                        </p>
                    `;
                }
            }

            const totalGeral = document.getElementById('totalGeral').textContent;

            html += `
                <div style="margin: 30px 0; text-align: center; font-size: 18px;">
                    <strong>Total ----------------------- ${totalGeral}</strong>
                </div>

                <div style="margin: 20px 0; font-style: italic;">
                    <p>Os valores devidos, ap√≥s fornecimento, ser√£o debitados na factura anual, caso n√£o sejam pagos contra a entrega dos elementos pedidos.</p>
                </div>

                <div style="margin-top: 40px;">
                    <div style="display: flex; justify-content: space-between; margin-top: 50px;">
                        <div style="text-align: center;">
                            <div style="border-bottom: 1px solid #000; width: 200px; height: 50px; margin-bottom: 10px;"></div>
                            <p><strong>O V‚à¥M‚à¥ ${nomeVM}</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="border-bottom: 1px solid #000; width: 200px; height: 50px; margin-bottom: 10px;"></div>
                            <p><strong>O Sec‚à¥ Orad‚à¥ ${nomeSecretario}</strong></p>
                        </div>
                    </div>
                    <div style="text-align: right; margin-top: 30px;">
                        <p><strong>Formul√°rio N¬∫ 12 FP</strong></p>
                    </div>
                </div>
            `;

            return html;
        }

        // Exportar para Word
        async function exportToWord() {
            if (!validateForm()) return;

            const { Document, Paragraph, TextRun, AlignmentType, HeadingLevel } = docx;

            const doc = new Document({
                sections: [{
                    properties: {},
                    children: [
                        new Paragraph({
                            text: "ORDEM MA√á√ìNICA MISTA INTERNACIONAL ¬´LE DROIT HUMAIN¬ª",
                            heading: HeadingLevel.TITLE,
                            alignment: AlignmentType.CENTER,
                        }),
                        new Paragraph({
                            text: "FEDERA√á√ÉO PORTUGUESA",
                            alignment: AlignmentType.CENTER,
                            spacing: { after: 200 }
                        }),
                        new Paragraph({
                            text: "FORNECIMENTOS",
                            heading: HeadingLevel.HEADING_1,
                            alignment: AlignmentType.CENTER,
                            spacing: { after: 400 }
                        })
                    ]
                }]
            });

            const blob = await docx.Packer.toBlob(doc);
            const fileName = `FP12_Fornecimentos_${document.getElementById('loja').value.replace(/\s+/g, '_')}.docx`;
            saveAs(blob, fileName);
        }

        // Exportar para PDF
        async function exportToPDF() {
            if (!validateForm()) return;

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');

            // Implementa√ß√£o do PDF seria aqui
            const fileName = `FP12_Fornecimentos_${document.getElementById('loja').value.replace(/\s+/g, '_')}.pdf`;
            pdf.save(fileName);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Definir data atual
            document.getElementById('dataPedido').value = new Date().toISOString().split('T')[0];
            
            // Modal
            document.querySelector('.close').addEventListener('click', function() {
                document.getElementById('previewModal').style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('previewModal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Valida√ß√£o em tempo real
        document.querySelectorAll('input[required], select[required]').forEach(field => {
            field.addEventListener('blur', function() {
                if (!this.value.trim()) {
                    this.style.borderColor = '#e74c3c';
                } else {
                    this.style.borderColor = '#27ae60';
                }
            });
        });

        // Personaliza√ß√£o do campo "Outra" loja
        document.getElementById('loja').addEventListener('change', function() {
            if (this.value === 'Outra') {
                const customLoja = prompt('Digite o nome da Loja:');
                if (customLoja) {
                    const option = new Option(customLoja, customLoja, true, true);
                    this.add(option);
                } else {
                    this.value = '';
                }
            }
        });
    </script>
</body>
</html>