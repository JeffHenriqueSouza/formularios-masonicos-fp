<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FP 11B - Pedido de Informa√ß√£o sobre Regularidade | Federa√ß√£o Portuguesa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="masonic" patternUnits="userSpaceOnUse" width="20" height="20"><path d="M10,2 L18,10 L10,18 L2,10 Z" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23masonic)"/></svg>');
            opacity: 0.1;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .form-content {
            padding: 40px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #8e44ad;
        }

        .section h2 {
            color: #8e44ad;
            margin-bottom: 20px;
            font-size: 24px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-row.single {
            grid-template-columns: 1fr;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #8e44ad;
            font-size: 14px;
        }

        input[type="text"],
        input[type="email"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #8e44ad;
            background: white;
            box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.1);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .logo-upload {
            border: 2px dashed #8e44ad;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .logo-upload:hover {
            border-color: #9b59b6;
            background: #ecf0f1;
        }

        .logo-upload.dragover {
            border-color: #8e44ad;
            background: #e8f4fd;
        }

        .signature-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
        }

        .signature-pad-container {
            border: 2px solid #8e44ad;
            border-radius: 8px;
            background: white;
            margin: 10px 0;
        }

        .signature-pad {
            width: 100%;
            height: 150px;
            border-radius: 6px;
        }

        .signature-controls {
            text-align: center;
            margin-top: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-export {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            font-size: 16px;
            padding: 15px 30px;
        }

        .export-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            text-align: center;
        }

        .status-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .status-group {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #ecf0f1;
        }

        .status-group h4 {
            color: #8e44ad;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-option input[type="radio"] {
            width: auto;
            margin: 0;
            scale: 1.2;
        }

        .logo-preview {
            max-width: 200px;
            max-height: 100px;
            margin: 10px auto;
            display: block;
            border-radius: 5px;
        }

        .form-mode-switch {
            background: #8e44ad;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .mode-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .mode-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: white;
            color: #8e44ad;
        }

        .mode-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .mode-btn.active:hover {
            background: white;
        }

        .section.hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .form-content {
                padding: 20px;
            }

            .mode-buttons {
                flex-direction: column;
            }
        }

        .required {
            color: #e74c3c;
        }

        .info-box {
            background: #e8f6f3;
            border: 1px solid #8e44ad;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #8e44ad;
            margin-bottom: 10px;
        }

        .stamp-box {
            border: 2px dashed #8e44ad;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã FP 11B - PEDIDO DE INFORMA√á√ÉO SOBRE REGULARIDADE</h1>
            <p>Ordem Ma√ß√≥nica Mista Internacional ¬´Le Droit Humain¬ª - Federa√ß√£o Portuguesa</p>
        </div>

        <div class="form-content">
            <!-- Seletor de Modo -->
            <div class="form-mode-switch">
                <h3>Escolha o tipo de documento:</h3>
                <div class="mode-buttons">
                    <button class="mode-btn active" onclick="switchMode('pedido')" id="btn-pedido">üìù PEDIDO DE INFORMA√á√ÉO</button>
                    <button class="mode-btn" onclick="switchMode('declaracao')" id="btn-declaracao">üìã DECLARA√á√ÉO</button>
                </div>
            </div>

            <form id="fp11bForm">
                <!-- Upload do Log√≥tipo -->
                <div class="form-group">
                    <label for="logoUpload">Log√≥tipo da Loja (opcional)</label>
                    <div class="logo-upload" id="logoUpload">
                        <p>üìÅ Clique ou arraste uma imagem aqui</p>
                        <small>Formatos aceites: JPG, PNG, GIF (m√°x. 2MB)</small>
                        <input type="file" id="logoFile" accept="image/*" style="display: none;">
                        <img id="logoPreview" class="logo-preview" style="display: none;">
                    </div>
                </div>

                <!-- SE√á√ÉO PEDIDO -->
                <div class="section" id="secao-pedido">
                    <h2>üìù PEDIDO DE INFORMA√á√ÉO</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="lojaRequerente">Loja Requerente <span class="required">*</span></label>
                            <select id="lojaRequerente" required>
                                <option value="">Selecione a Loja</option>
                                <option value="Loja Ac√°cia N¬∫ 1">Loja Ac√°cia N¬∫ 1</option>
                                <option value="Loja Liberdade N¬∫ 2">Loja Liberdade N¬∫ 2</option>
                                <option value="Loja Fraternidade N¬∫ 3">Loja Fraternidade N¬∫ 3</option>
                                <option value="Loja Igualdade N¬∫ 4">Loja Igualdade N¬∫ 4</option>
                                <option value="Loja Harmonia N¬∫ 5">Loja Harmonia N¬∫ 5</option>
                                <option value="Outra">Outra</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="numeroLojaRequerente">N√∫mero da Loja</label>
                            <input type="text" id="numeroLojaRequerente" placeholder="N√∫mero da loja">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="orienteRequerente">Oriente <span class="required">*</span></label>
                            <input type="text" id="orienteRequerente" required placeholder="Ex: Lisboa">
                        </div>
                        <div class="form-group">
                            <label for="dataPedido">Data do Pedido <span class="required">*</span></label>
                            <input type="date" id="dataPedido" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="nomeMemberPedido">Nome do Membro (sobre quem se solicita informa√ß√£o) <span class="required">*</span></label>
                        <input type="text" id="nomeMemberPedido" required placeholder="Nome completo do membro">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="presidenteAtelierPedido">Presidente do Atelier <span class="required">*</span></label>
                            <input type="text" id="presidenteAtelierPedido" required placeholder="Nome do Presidente do Atelier">
                        </div>
                        <div class="form-group">
                            <label for="secretarioOradorPedido">Secret√°rio Orador <span class="required">*</span></label>
                            <input type="text" id="secretarioOradorPedido" required placeholder="Nome do Secret√°rio Orador">
                        </div>
                    </div>
                </div>

                <!-- SE√á√ÉO DECLARA√á√ÉO -->
                <div class="section hidden" id="secao-declaracao">
                    <h2>üìã DECLARA√á√ÉO</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="lojaDeclarante">Loja Declarante <span class="required">*</span></label>
                            <select id="lojaDeclarante" required>
                                <option value="">Selecione a Loja</option>
                                <option value="Loja Ac√°cia N¬∫ 1">Loja Ac√°cia N¬∫ 1</option>
                                <option value="Loja Liberdade N¬∫ 2">Loja Liberdade N¬∫ 2</option>
                                <option value="Loja Fraternidade N¬∫ 3">Loja Fraternidade N¬∫ 3</option>
                                <option value="Loja Igualdade N¬∫ 4">Loja Igualdade N¬∫ 4</option>
                                <option value="Loja Harmonia N¬∫ 5">Loja Harmonia N¬∫ 5</option>
                                <option value="Outra">Outra</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="numeroLojaDeclarante">N√∫mero da Loja</label>
                            <input type="text" id="numeroLojaDeclarante" placeholder="N√∫mero da loja">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="orienteDeclarante">Oriente <span class="required">*</span></label>
                            <input type="text" id="orienteDeclarante" required placeholder="Ex: Lisboa">
                        </div>
                        <div class="form-group">
                            <label for="dataDeclaracao">Data da Declara√ß√£o <span class="required">*</span></label>
                            <input type="date" id="dataDeclaracao" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="nomeMemberDeclaracao">Nome do Membro <span class="required">*</span></label>
                        <input type="text" id="nomeMemberDeclaracao" required placeholder="Nome completo do membro">
                    </div>

                    <div class="info-box">
                        <h4>Conforme solicitado, informamos que o membro desta R‚à¥L‚à¥:</h4>
                    </div>

                    <div class="status-options">
                        <div class="status-group">
                            <h4>Assiduidade</h4>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="assiduo-sim" name="assiduidade" value="sim">
                                    <label for="assiduo-sim">√â ass√≠duo(a)</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="assiduo-nao" name="assiduidade" value="nao">
                                    <label for="assiduo-nao">N√£o √© ass√≠duo(a)</label>
                                </div>
                            </div>
                        </div>

                        <div class="status-group">
                            <h4>Situa√ß√£o com o Tesouro</h4>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="tesouro-sim" name="tesouro" value="sim">
                                    <label for="tesouro-sim">Est√° em regra com o Tesouro</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="tesouro-nao" name="tesouro" value="nao">
                                    <label for="tesouro-nao">N√£o est√° em regra com o Tesouro</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>üìñ Refer√™ncia Legal</h4>
                        <p>Conforme estipulado nos Regulamentos da Federa√ß√£o Portuguesa:</p>
                        <p><strong>Art. 9¬∫</strong> - Obriga√ß√µes financeiras dos membros</p>
                        <p><strong>Art. 56¬∫</strong> - Assiduidade aos trabalhos</p>
                        <p><strong>Art. 57¬∫</strong> - Conduta ma√ß√≥nica</p>
                    </div>

                    <div class="form-group">
                        <label for="observacoes">Observa√ß√µes</label>
                        <textarea id="observacoes" placeholder="Observa√ß√µes adicionais (opcional)"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="presidenteAtelierDeclaracao">Presidente do Atelier <span class="required">*</span></label>
                            <input type="text" id="presidenteAtelierDeclaracao" required placeholder="Nome do Presidente do Atelier">
                        </div>
                        <div class="form-group">
                            <label for="secretarioOradorDeclaracao">Secret√°rio Orador <span class="required">*</span></label>
                            <input type="text" id="secretarioOradorDeclaracao" required placeholder="Nome do Secret√°rio Orador">
                        </div>
                    </div>
                </div>

                <!-- Carimbo da Loja -->
                <div class="stamp-box">
                    <h4>Carimbo da Loja</h4>
                    <p style="color: #666; font-style: italic;">Espa√ßo reservado para o carimbo oficial da loja</p>
                </div>

                <!-- Assinatura Digital -->
                <div class="signature-section">
                    <h3>Assinaturas Digitais</h3>
                    <div class="form-row">
                        <div>
                            <p><strong>Presidente do Atelier:</strong></p>
                            <div class="signature-pad-container">
                                <canvas class="signature-pad" id="signaturePadPresident"></canvas>
                            </div>
                            <div class="signature-controls">
                                <button type="button" class="btn btn-secondary" onclick="clearSignature('signaturePadPresident')">üóëÔ∏è Limpar</button>
                            </div>
                        </div>
                        <div>
                            <p><strong>Secret√°rio Orador:</strong></p>
                            <div class="signature-pad-container">
                                <canvas class="signature-pad" id="signaturePadSecretary"></canvas>
                            </div>
                            <div class="signature-controls">
                                <button type="button" class="btn btn-secondary" onclick="clearSignature('signaturePadSecretary')">üóëÔ∏è Limpar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Exporta√ß√£o -->
                <div class="export-section">
                    <h3>üíæ Exportar Documento</h3>
                    <p>Escolha o formato de exporta√ß√£o desejado:</p>
                    <button type="button" class="btn btn-export" onclick="exportToWord()">üìÑ Exportar para Word</button>
                    <button type="button" class="btn btn-export" onclick="exportToPDF()">üìã Exportar para PDF</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Estado atual do formul√°rio
        let currentMode = 'pedido';

        // Inicializar Signature Pads
        const canvasPresident = document.getElementById('signaturePadPresident');
        const canvasSecretary = document.getElementById('signaturePadSecretary');
        const signaturePadPresident = new SignaturePad(canvasPresident);
        const signaturePadSecretary = new SignaturePad(canvasSecretary);

        // Redimensionar canvas
        function resizeCanvas(canvas, signaturePad) {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            canvas.getContext("2d").scale(ratio, ratio);
            signaturePad.clear();
        }

        function resizeAllCanvas() {
            resizeCanvas(canvasPresident, signaturePadPresident);
            resizeCanvas(canvasSecretary, signaturePadSecretary);
        }

        window.addEventListener("resize", resizeAllCanvas);
        setTimeout(resizeAllCanvas, 100);

        // Limpar assinatura
        function clearSignature(canvasId) {
            if (canvasId === 'signaturePadPresident') {
                signaturePadPresident.clear();
            } else if (canvasId === 'signaturePadSecretary') {
                signaturePadSecretary.clear();
            }
        }

        // Alternar entre modos
        function switchMode(mode) {
            currentMode = mode;
            
            // Atualizar bot√µes
            document.getElementById('btn-pedido').classList.toggle('active', mode === 'pedido');
            document.getElementById('btn-declaracao').classList.toggle('active', mode === 'declaracao');
            
            // Mostrar/ocultar se√ß√µes
            document.getElementById('secao-pedido').classList.toggle('hidden', mode !== 'pedido');
            document.getElementById('secao-declaracao').classList.toggle('hidden', mode !== 'declaracao');
        }

        // Upload de log√≥tipo
        const logoUpload = document.getElementById('logoUpload');
        const logoFile = document.getElementById('logoFile');
        const logoPreview = document.getElementById('logoPreview');

        logoUpload.addEventListener('click', () => logoFile.click());
        
        logoUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            logoUpload.classList.add('dragover');
        });

        logoUpload.addEventListener('dragleave', () => {
            logoUpload.classList.remove('dragover');
        });

        logoUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            logoUpload.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleLogoFile(files[0]);
            }
        });

        logoFile.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleLogoFile(e.target.files[0]);
            }
        });

        function handleLogoFile(file) {
            if (file.type.startsWith('image/') && file.size <= 2 * 1024 * 1024) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    logoPreview.src = e.target.result;
                    logoPreview.style.display = 'block';
                    logoUpload.innerHTML = `
                        <img src="${e.target.result}" class="logo-preview">
                        <p>‚úÖ Log√≥tipo carregado</p>
                        <small>Clique para alterar</small>
                    `;
                };
                reader.readAsDataURL(file);
            } else {
                alert('Por favor, selecione uma imagem v√°lida (m√°x. 2MB).');
            }
        }

        // Valida√ß√£o de formul√°rio
        function validateForm() {
            const requiredFields = currentMode === 'pedido' ? 
                ['lojaRequerente', 'orienteRequerente', 'dataPedido', 'nomeMemberPedido', 'presidenteAtelierPedido', 'secretarioOradorPedido'] :
                ['lojaDeclarante', 'orienteDeclarante', 'dataDeclaracao', 'nomeMemberDeclaracao', 'presidenteAtelierDeclaracao', 'secretarioOradorDeclaracao'];

            let valid = true;

            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && !field.value.trim()) {
                    field.style.borderColor = '#e74c3c';
                    valid = false;
                } else if (field) {
                    field.style.borderColor = '#ecf0f1';
                }
            });

            if (currentMode === 'declaracao') {
                const assiduidade = document.querySelector('input[name="assiduidade"]:checked');
                const tesouro = document.querySelector('input[name="tesouro"]:checked');
                
                if (!assiduidade || !tesouro) {
                    alert('Por favor, selecione as op√ß√µes de assiduidade e situa√ß√£o com o tesouro.');
                    valid = false;
                }
            }

            if (signaturePadPresident.isEmpty() || signaturePadSecretary.isEmpty()) {
                alert('Por favor, assine o documento (ambas as assinaturas s√£o obrigat√≥rias).');
                valid = false;
            }

            return valid;
        }

        // Exportar para Word
        async function exportToWord() {
            if (!validateForm()) return;

            const { Document, Paragraph, TextRun, AlignmentType, HeadingLevel } = docx;

            const doc = new Document({
                sections: [{
                    properties: {},
                    children: [
                        new Paragraph({
                            text: "ORDEM MA√á√ìNICA MISTA INTERNACIONAL ¬´LE DROIT HUMAIN¬ª",
                            heading: HeadingLevel.TITLE,
                            alignment: AlignmentType.CENTER,
                        }),
                        new Paragraph({
                            text: "FEDERA√á√ÉO PORTUGUESA",
                            alignment: AlignmentType.CENTER,
                            spacing: { after: 400 }
                        })
                    ]
                }]
            });

            if (currentMode === 'pedido') {
                // Se√ß√£o Pedido
                doc.addSection({
                    children: [
                        new Paragraph({
                            text: "PEDIDO DE INFORMA√á√ÉO",
                            heading: HeadingLevel.HEADING_1,
                            alignment: AlignmentType.CENTER
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: "R‚à¥L‚à¥ n¬∫ ", bold: true }),
                                new TextRun(document.getElementById('numeroLojaRequerente').value || "____"),
                                new TextRun({ text: " - ", bold: true }),
                                new TextRun(document.getElementById('lojaRequerente').value)
                            ]
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: "Or‚à¥ de ", bold: true }),
                                new TextRun(document.getElementById('orienteRequerente').value),
                                new TextRun({ text: ", ", bold: true }),
                                new TextRun(document.getElementById('dataPedido').value)
                            ]
                        }),
                        new Paragraph({
                            text: "",
                            spacing: { after: 200 }
                        }),
                        new Paragraph({
                            text: `Solicita informa√ß√£o sobre a regularidade do/a I‚à¥/I‚à¥a ${document.getElementById('nomeMemberPedido').value}`
                        }),
                        new Paragraph({
                            text: "",
                            spacing: { after: 400 }
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: "O Pres‚à¥ do Atel‚à¥: ", bold: true }),
                                new TextRun(document.getElementById('presidenteAtelierPedido').value)
                            ]
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: "O Sec‚à¥ Or‚à¥: ", bold: true }),
                                new TextRun(document.getElementById('secretarioOradorPedido').value)
                            ]
                        })
                    ]
                });
            } else {
                // Se√ß√£o Declara√ß√£o
                const assiduidade = document.querySelector('input[name="assiduidade"]:checked')?.value;
                const tesouro = document.querySelector('input[name="tesouro"]:checked')?.value;
                
                doc.addSection({
                    children: [
                        new Paragraph({
                            text: "DECLARA√á√ÉO",
                            heading: HeadingLevel.HEADING_1,
                            alignment: AlignmentType.CENTER
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: "R‚à¥L‚à¥ n¬∫ ", bold: true }),
                                new TextRun(document.getElementById('numeroLojaDeclarante').value || "____"),
                                new TextRun({ text: " - ", bold: true }),
                                new TextRun(document.getElementById('lojaDeclarante').value)
                            ]
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: "Or‚à¥ de ", bold: true }),
                                new TextRun(document.getElementById('orienteDeclarante').value),
                                new TextRun({ text: ", ", bold: true }),
                                new TextRun(document.getElementById('dataDeclaracao').value)
                            ]
                        }),
                        new Paragraph({
                            text: "",
                            spacing: { after: 200 }
                        }),
                        new Paragraph({
                            text: "Conforme solicitado, informamos que o membro desta R‚à¥L‚à¥:",
                            spacing: { after: 200 }
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: "Nome: ", bold: true }),
                                new TextRun(document.getElementById('nomeMemberDeclaracao').value)
                            ]
                        }),
                        new Paragraph({
                            text: "Nesta data:",
                            spacing: { after: 100 }
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: assiduidade === 'sim' ? "‚òë √â ass√≠duo(a)" : "‚òê √â ass√≠duo(a)", bold: true })
                            ]
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: assiduidade === 'nao' ? "‚òë N√£o √© ass√≠duo(a)" : "‚òê N√£o √© ass√≠duo(a)", bold: true })
                            ]
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: tesouro === 'sim' ? "‚òë Est√° em regra com o Tesouro" : "‚òê Est√° em regra com o Tesouro", bold: true })
                            ]
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: tesouro === 'nao' ? "‚òë N√£o est√° em regra com o Tesouro" : "‚òê N√£o est√° em regra com o Tesouro", bold: true })
                            ]
                        }),
                        new Paragraph({
                            text: "",
                            spacing: { after: 200 }
                        }),
                        new Paragraph({
                            text: "Conforme estipulado nos Regulamentos da Federa√ß√£o Portuguesa, Art¬∫s 9¬∫, 56¬∫, 57¬∫.",
                            spacing: { after: 200 }
                        })
                    ]
                });

                // Observa√ß√µes se existirem
                const observacoes = document.getElementById('observacoes').value;
                if (observacoes.trim()) {
                    doc.addSection({
                        children: [
                            new Paragraph({
                                children: [
                                    new TextRun({ text: "Obs. ", bold: true }),
                                    new TextRun(observacoes)
                                ]
                            })
                        ]
                    });
                }

                // Assinaturas
                doc.addSection({
                    children: [
                        new Paragraph({
                            text: "",
                            spacing: { after: 400 }
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: "O Pres‚à¥ do Atel‚à¥: ", bold: true }),
                                new TextRun(document.getElementById('presidenteAtelierDeclaracao').value)
                            ]
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({ text: "O Sec‚à¥ Or‚à¥: ", bold: true }),
                                new TextRun(document.getElementById('secretarioOradorDeclaracao').value)
                            ]
                        }),
                        new Paragraph({
                            text: "",
                            spacing: { after: 200 }
                        }),
                        new Paragraph({
                            text: "Formul√°rio N¬∫ 11B",
                            alignment: AlignmentType.RIGHT
                        })
                    ]
                });
            }

            const blob = await docx.Packer.toBlob(doc);
            const fileName = `FP11B_${currentMode === 'pedido' ? 'Pedido' : 'Declaracao'}_${Date.now()}.docx`;
            saveAs(blob, fileName);
        }

        // Exportar para PDF
        async function exportToPDF() {
            if (!validateForm()) return;

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');

            // Configura√ß√µes
            const pageWidth = pdf.internal.pageSize.getWidth();
            const margin = 20;
            let currentY = 30;

            // Cabe√ßalho
            pdf.setFontSize(16);
            pdf.setFont(undefined, 'bold');
            pdf.text('ORDEM MA√á√ìNICA MISTA INTERNACIONAL ¬´LE DROIT HUMAIN¬ª', pageWidth / 2, currentY, { align: 'center' });
            currentY += 8;
            pdf.text('FEDERA√á√ÉO PORTUGUESA', pageWidth / 2, currentY, { align: 'center' });
            currentY += 20;

            if (currentMode === 'pedido') {
                // Se√ß√£o Pedido
                pdf.setFontSize(14);
                pdf.text('PEDIDO DE INFORMA√á√ÉO', pageWidth / 2, currentY, { align: 'center' });
                currentY += 15;

                pdf.setFontSize(11);
                pdf.setFont(undefined, 'normal');
                pdf.text(`R‚à¥L‚à¥ n¬∫ ${document.getElementById('numeroLojaRequerente').value || '____'} - ${document.getElementById('lojaRequerente').value}`, margin, currentY);
                currentY += 8;
                pdf.text(`Or‚à¥ de ${document.getElementById('orienteRequerente').value}, ${document.getElementById('dataPedido').value}`, margin, currentY);
                currentY += 15;

                pdf.text(`Solicita informa√ß√£o sobre a regularidade do/a I‚à¥/I‚à¥a ${document.getElementById('nomeMemberPedido').value}`, margin, currentY);
                currentY += 25;

                pdf.text(`O Pres‚à¥ do Atel‚à¥: ${document.getElementById('presidenteAtelierPedido').value}`, margin, currentY);
                currentY += 8;
                pdf.text(`O Sec‚à¥ Or‚à¥: ${document.getElementById('secretarioOradorPedido').value}`, margin, currentY);

            } else {
                // Se√ß√£o Declara√ß√£o
                pdf.setFontSize(14);
                pdf.text('DECLARA√á√ÉO', pageWidth / 2, currentY, { align: 'center' });
                currentY += 15;

                pdf.setFontSize(11);
                pdf.setFont(undefined, 'normal');
                pdf.text(`R‚à¥L‚à¥ n¬∫ ${document.getElementById('numeroLojaDeclarante').value || '____'} - ${document.getElementById('lojaDeclarante').value}`, margin, currentY);
                currentY += 8;
                pdf.text(`Or‚à¥ de ${document.getElementById('orienteDeclarante').value}, ${document.getElementById('dataDeclaracao').value}`, margin, currentY);
                currentY += 15;

                pdf.text('Conforme solicitado, informamos que o membro desta R‚à¥L‚à¥:', margin, currentY);
                currentY += 10;
                pdf.text(`Nome: ${document.getElementById('nomeMemberDeclaracao').value}`, margin, currentY);
                currentY += 10;

                const assiduidade = document.querySelector('input[name="assiduidade"]:checked')?.value;
                const tesouro = document.querySelector('input[name="tesouro"]:checked')?.value;

                pdf.text('Nesta data:', margin, currentY);
                currentY += 8;
                pdf.text(`${assiduidade === 'sim' ? '‚òë' : '‚òê'} √â ass√≠duo(a)`, margin + 5, currentY);
                currentY += 6;
                pdf.text(`${assiduidade === 'nao' ? '‚òë' : '‚òê'} N√£o √© ass√≠duo(a)`, margin + 5, currentY);
                currentY += 6;
                pdf.text(`${tesouro === 'sim' ? '‚òë' : '‚òê'} Est√° em regra com o Tesouro`, margin + 5, currentY);
                currentY += 6;
                pdf.text(`${tesouro === 'nao' ? '‚òë' : '‚òê'} N√£o est√° em regra com o Tesouro`, margin + 5, currentY);
                currentY += 15;

                pdf.text('Conforme estipulado nos Regulamentos da Federa√ß√£o Portuguesa, Art¬∫s 9¬∫, 56¬∫, 57¬∫.', margin, currentY);
                currentY += 15;

                const observacoes = document.getElementById('observacoes').value;
                if (observacoes.trim()) {
                    pdf.text(`Obs. ${observacoes}`, margin, currentY);
                    currentY += 15;
                }

                pdf.text(`O Pres‚à¥ do Atel‚à¥: ${document.getElementById('presidenteAtelierDeclaracao').value}`, margin, currentY);
                currentY += 8;
                pdf.text(`O Sec‚à¥ Or‚à¥: ${document.getElementById('secretarioOradorDeclaracao').value}`, margin, currentY);
            }

            // Assinaturas
            currentY += 20;
            if (!signaturePadPresident.isEmpty()) {
                const signatureDataPresident = signaturePadPresident.toDataURL();
                pdf.addImage(signatureDataPresident, 'PNG', margin, currentY, 60, 20);
            }
            if (!signaturePadSecretary.isEmpty()) {
                const signatureDataSecretary = signaturePadSecretary.toDataURL();
                pdf.addImage(signatureDataSecretary, 'PNG', pageWidth - margin - 60, currentY, 60, 20);
            }

            // Footer
            pdf.setFontSize(10);
            pdf.text('Formul√°rio N¬∫ 11B', pageWidth - margin, pdf.internal.pageSize.getHeight() - 10, { align: 'right' });

            const fileName = `FP11B_${currentMode === 'pedido' ? 'Pedido' : 'Declaracao'}_${Date.now()}.pdf`;
            pdf.save(fileName);
        }

        // Valida√ß√£o em tempo real
        document.querySelectorAll('input[required], select[required]').forEach(field => {
            field.addEventListener('blur', function() {
                if (!this.value.trim()) {
                    this.style.borderColor = '#e74c3c';
                } else {
                    this.style.borderColor = '#27ae60';
                }
            });
        });

        // Personaliza√ß√£o do campo "Outra" loja
        document.getElementById('lojaRequerente').addEventListener('change', function() {
            if (this.value === 'Outra') {
                const customLoja = prompt('Digite o nome da Loja:');
                if (customLoja) {
                    const option = new Option(customLoja, customLoja, true, true);
                    this.add(option);
                } else {
                    this.value = '';
                }
            }
        });

        document.getElementById('lojaDeclarante').addEventListener('change', function() {
            if (this.value === 'Outra') {
                const customLoja = prompt('Digite o nome da Loja:');
                if (customLoja) {
                    const option = new Option(customLoja, customLoja, true, true);
                    this.add(option);
                } else {
                    this.value = '';
                }
            }
        });
    </script>
</body>
</html>